<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register Participant</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-10">
    <div class="max-w-xl mx-auto bg-white p-8 rounded shadow">
        <h1 class="text-2xl font-bold mb-6">Register Participant</h1>

        <!-- Mensaje de Ã©xito y error -->
        <div id="successMessage" class="hidden bg-green-100 text-green-800 p-4 mb-4 rounded"></div>
        <div id="errorMessage" class="hidden bg-red-100 text-red-800 p-4 mb-4 rounded"></div>

        <!-- Formulario -->
        <form id="registerForm" class="space-y-4">
            <div>
                <label class="block mb-1 font-medium">Full Name:</label>
                <input name="name" class="w-full p-2 border rounded" required>
            </div>

            <div>
                <label class="block mb-1 font-medium">Birth Date:</label>
                <input type="date" name="birth_date" class="w-full p-2 border rounded" required>
            </div>

            <div>
                <label class="block mb-1 font-medium">Weight (kg):</label>
                <input type="number" step="0.1" name="weight" class="w-full p-2 border rounded" required>
            </div>

            <div>
                <label class="block mb-1 font-medium">Height (cm):</label>
                <input type="number" step="0.1" name="height" class="w-full p-2 border rounded" required>
            </div>

            <div>
                <label class="block mb-1 font-medium">Academy:</label>
                <input name="academy" class="w-full p-2 border rounded" required>
            </div>

            <div>
                <label class="block mb-1 font-medium">Category:</label>
                <input name="category" class="w-full p-2 border rounded" required>
            </div>

            <div>
                <label class="block mb-1 font-medium">Email:</label>
                <input type="email" name="email" class="w-full p-2 border rounded" required>
            </div>

            <div>
                <label class="block mb-1 font-medium">Grade:</label>
                <input name="grade" class="w-full p-2 border rounded">
            </div>

            <div>
                <label class="block mb-1 font-medium">Belt:</label>
                <input name="belt" class="w-full p-2 border rounded" value="white">
            </div>

            <div>
                <label class="block mb-1 font-medium">Torneo:</label>
                <input name="torneo" class="w-full p-2 border rounded" required>
            </div>

            <div>
                <button type="submit" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                    Register
                </button>
            </div>
        </form>
    </div>

    <!-- Loading Spinner -->
    <div id="loading" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center">
        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24"></div>
    </div>

    <script>
        const form = document.getElementById('registerForm');
        const loading = document.getElementById('loading');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            loading.classList.remove('hidden');
            successMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');

            const data = {
                name: form.name.value,
                birth_date: form.birth_date.value,
                weight: parseFloat(form.weight.value),
                height: parseFloat(form.height.value),
                academy: form.academy.value,
                category: form.category.value,
                email: form.email.value,
                grade: form.grade.value || null,
                belt: form.belt.value || "white",
                torneo: form.torneo.value,
                payment_proof: null
            };

            try {
                const res = await fetch('https://vjfpbq4jbiz5uyarfu7z7ahlhi0xbhmi.lambda-url.us-east-1.on.aws/participants', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();

                if (!res.ok) {
                    errorMessage.textContent = result.detail?.message || JSON.stringify(result);
                    errorMessage.classList.remove('hidden');
                } else {
                    successMessage.textContent = result.message;
                    successMessage.classList.remove('hidden');
                    form.reset();
                }
            } catch (err) {
                console.error(err);
                errorMessage.textContent = "Error al registrar participante.";
                errorMessage.classList.remove('hidden');
            } finally {
                loading.classList.add('hidden');
            }
        });
    </script>

    <style>
        .loader {
            border-top-color: #1DB954;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</body>
</html>