<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Register Participant</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 p-10">

    <!-- AquÃ­ incluimos el formulario modular -->
    <section id="register-form">
        {% include "register_form.html" %}
    </section>

    <!-- Loading Spinner -->
    <div id="loading" class="hidden fixed inset-0 bg-gray-800 bg-opacity-50 flex items-center justify-center">
        <div class="loader ease-linear rounded-full border-8 border-t-8 border-gray-200 h-24 w-24"></div>
    </div>

    <!-- Script de registro -->
    <script>
        const form = document.getElementById('registerForm');
        const loading = document.getElementById('loading');
        const successMessage = document.getElementById('successMessage');
        const errorMessage = document.getElementById('errorMessage');

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            loading.classList.remove('hidden');
            successMessage.classList.add('hidden');
            errorMessage.classList.add('hidden');

            const data = {
                name: form.name.value,
                birth_date: form.birth_date.value,
                weight: parseFloat(form.weight.value),
                height: parseFloat(form.height.value),
                academy: form.academy.value,
                category: form.category.value,
                email: form.email.value,
                grade: form.grade.value || null,
                belt: form.belt.value || "white",
                torneo: form.torneo.value,
                payment_proof: null
            };

            try {
                const res = await fetch('https://vjfpbq4jbiz5uyarfu7z7ahlhi0xbhmi.lambda-url.us-east-1.on.aws/participants', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                const result = await res.json();

                if (!res.ok) {
                    errorMessage.textContent = result.detail?.message || JSON.stringify(result);
                    errorMessage.classList.remove('hidden');
                } else {
                    successMessage.textContent = result.message;
                    successMessage.classList.remove('hidden');
                    form.reset();
                }
            } catch (err) {
                console.error(err);
                errorMessage.textContent = "Error al registrar participante.";
                errorMessage.classList.remove('hidden');
            } finally {
                loading.classList.add('hidden');
            }
        });
    </script>

    <style>
        .loader {
            border-top-color: #1DB954;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
    </style>
</body>
</html>